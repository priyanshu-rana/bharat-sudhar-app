# Bharat Sudhar App

A civic engagement app to report and track local issues.

## Build Instructions

### Understanding Android Keystore

A Keystore is a crucial security element in Android app development. It serves multiple important purposes:

1. **App Signing**: The Keystore contains a private key used to digitally sign your app. This signature:
   - Proves that the app comes from you (the developer)
   - Ensures the app hasn't been tampered with
   - Is required by Google Play Store

2. **App Updates**: 
   - The same Keystore must be used for all updates of your app
   - If you lose the Keystore, you cannot update your app on the Play Store
   - You would need to publish a new app with a new package name

3. **Types of Keystores**:
   - **Debug Keystore**: Used during development (auto-generated by Android Studio)
   - **Release Keystore**: Used for Play Store releases (what we create in these instructions)

⚠️ **IMPORTANT**: 
- Never share or expose your release Keystore
- Keep secure backups of your Keystore file and its credentials
- Store the Keystore password and key password safely
- The Keystore file in our `builds` directory is for testing only

### Converting AAB to APK

If you need to convert an Android App Bundle (AAB) to an APK for testing, follow these steps:

1. **Setup Directory Structure**
```bash
mkdir -p builds/tools builds/android
```

2. **Download Bundletool**
```bash
curl -L -o builds/tools/bundletool.jar https://github.com/google/bundletool/releases/download/1.15.6/bundletool-all-1.15.6.jar
```

3. **Generate Keystore** (if you don't have one)
```bash
keytool -genkey -v -keystore builds/android/release-key.keystore \
  -alias my-key-alias \
  -keyalg RSA \
  -keysize 2048 \
  -validity 10000 \
  -storepass android \
  -keypass android \
  -dname "CN=BharatSudhar, OU=Development, O=BharatSudhar, L=Unknown, ST=Unknown, C=IN"
```

Parameters explained:
- `-keystore`: Location and name of the Keystore file
- `-alias`: A unique identifier for the key
- `-keyalg RSA`: Using RSA algorithm for key generation
- `-keysize 2048`: Key length in bits (2048 is standard)
- `-validity 10000`: Key will be valid for 10000 days
- `-storepass`: Password for the Keystore file
- `-keypass`: Password for this specific key
- `-dname`: Distinguished name fields:
  - CN (Common Name): Your app/organization name
  - OU (Organizational Unit): Department
  - O (Organization): Company name
  - L (Location): City
  - ST (State): State/Province
  - C (Country): 2-letter country code

4. **Convert AAB to APK**
```bash
# Move your AAB file to builds/android/app-release.aab first
java -jar builds/tools/bundletool.jar build-apks \
  --bundle=builds/android/app-release.aab \
  --output=builds/android/app-release.apks \
  --ks=builds/android/release-key.keystore \
  --ks-pass=pass:android \
  --ks-key-alias=my-key-alias \
  --key-pass=pass:android \
  --mode=universal
```

5. **Extract the Universal APK**
```bash
cd builds/android && unzip app-release.apks
mv universal.apk app-release.apk
rm toc.pb app-release.apks
cd ../..
```

The final APK will be available at `builds/android/app-release.apk`

### Directory Structure

```
builds/
├── android/
│   ├── app-release.aab    # Your AAB file
│   ├── app-release.apk    # Converted APK
│   └── release-key.keystore # Keystore for signing
└── tools/
    └── bundletool.jar     # Tool for AAB to APK conversion
```

Note: The `builds` directory is gitignored to avoid committing large binary files.
